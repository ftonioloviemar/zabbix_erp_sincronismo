#!/usr/bin/env python3
"""Testes usando HTML real do sistema para validar a função parse_status_page."""

import os
import sys
import unittest
from datetime import datetime, timedelta

# Adiciona o diretório pai ao path para importar check_sincronismo
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from check_sincronismo import parse_status_page, STATUS_OK

class TestParseStatusPageReal(unittest.TestCase):
    """Testes usando HTML real do sistema."""
    
    def setUp(self):
        """Configuração inicial para cada teste."""
        self.maxDiff = None
    
    def test_html_real_extraido(self):
        """Testa com HTML real extraído do sistema."""
        # Usa o HTML real do arquivo debug
        html_real = '''<div class='vista-role' style='position: absolute; top:0px; left:0px; bottom:4px; right:0px; overflow: auto;' role='vista' perfil='' cvista='2052' svistaaba='2902'>   <img src='/Tecnicon/images/tbpds/salvar-perfil.png' style='width: 20px;cursor: pointer;margin-right: 5px; float:left; padding-top: 5px; padding-left:5px;' title='Salvar perfil da vista' onclick="carregaSalvaPerfil(this,4,2902,'formParametros','salvaPerfilUsuario','param-um-vista');">   <img src='/Tecnicon/images/tbpds/perfil-excluir.png' style='width: 20px;cursor: pointer;margin-right: 5px; float:left; padding-top: 5px;' id='btnExcluirPerfilVista' title='Excluir perfil da vista' onclick="excluirPerfilVista(this,undefined);"><img src='/TecResource/imgs/tecia/tecia-icon.png' style='display:none;' class='vista-icons' id='btnVistaTecia' onclick='Vista.btnOpenTecia(event)'><div id='painel-titulo-param' style='padding-top:10px; padding-bottom:10px; margin-bottom: 5px;'><b style='float:left;max-width: 80%'>Status Sincronismo - Status Sincronismo</b><div style='overflow:auto; height:14px; padding-left:4px;' title=''></div></div><div class='div-oculta' id='param-um-vista'>{"parametros":[]}</div><div class='div-oculta' id='param-dois-vista'>svistaaba|2902</div><fieldset id='fs2902' vistasql='3102' style='width:100%; margin-top:0px;' tamanhoauto='S'><legend><div style='float:left; margin-right:5px;'>           <img src='/Tecnicon/images/ferramentas/32x32/refresh-js.png' id='btnRecarregarGrid' style='width: 20px;cursor: pointer;float:left;' title='Recarregar Dados' onclick="carregarVistaEsp(3102,2052,'',2902,this)">           <img src='/Tecnicon/images/tbpds/btn-atualiza-grid-auto.png' style='width: 18px;cursor: pointer;margin-right: 3px;margin-left: 3px;padding-top: 2px;' title='Definir Tempo de Atualização' onclick="abreDefineTempo(this);"></div><div style='float:left; padding-top:6px;'><b>Select Status Sincronismo</b></div><div style='clear:both;'></div></legend><script type="text/javascript" id="scriptGrid13920249-8ef9-4f5f-90be-be7153819e4f"> var script = document.getElementById("scriptGrid13920249-8ef9-4f5f-90be-be7153819e4f"); var tela = (document.contains(script) ? parentUntilAttr(script, "role", "dialog") : quemsou) || document; arrumaColunas(tela.querySelector("#tbltblConCon2902"));TGrid(tela.querySelector("#tbltblConCon2902"), {pesquisa:true, vistas:true, paginacao:true,colunasCongeladas: false,pesquisaEsp:true, regPorPg: 29, camposPesq: [ 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,],SSQL: 3102,NOMECONSULTA: 'Vista.3102'}); </script><div id='tbltblConCon2902'  role='grid' class='div-grid-vistas'  tempoupdate='00:00:00'   cabecalho='Cód. Local||Filial||Ultimo Reg. Receb.||Data Ult. Reg. Receb.||Hora Ult. Reg. Receb.||Ultimo Reg. Env.||Qtde Falta Receber||Data Ult. Reg. Env.||Hora Ultimo Reg. Env.||Qtde Falta Enviar||Qtde Receber||Qtde Enviar||Log Filial p/ Sinc.||Data Atual||Log Sinc. p/ Filial||Hr Atual' style='position: absolute;top: 59px;left: 0px;right: 0px;bottom: 10px;' realce='null'>     <div class="div-header-grid">         <table id="tblHead" class="TGrid" cellpadding="0" cellspacing="0"><thead><tr><th title="Cód. Local"  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;' rel='V' cp='CLOCAL'><div style=''><div style='float:left;'>Cód. Local</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Filial"  agrupador='false' role='cabecalho' tam='50'  onrowdraw='[]' style='position:relative;' rel='V' cp='NOMEFILIAL'><div style=''><div style='float:left;'>Filial</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Ultimo Reg. Receb."  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;' rel='I' cp='ULTIMOREC'><div style='text-align: right;'><div style='float:left;'>Ultimo Reg. Receb.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Data Ult. Reg. Receb."  agrupador='false' role='cabecalho' tam='10'  onrowdraw='["var dtAtual = RetornaColuna(registro, RetornaSeqColuna(grid, \"DTATUAL\"), true);\n\nif (comparaData(dtAtual, \">\", valor)) {\n    cor = \"TOMATO\";\n}\n\ncolunas = [RetornaSeqColuna(grid, \"HRULTIMOREC\"), RetornaSeqColuna(grid, \"DTULTIMOREC\")];"]' style='position:relative;' rel='D' cp='DTULTIMOREC'><div style=''><div style='float:left;'>Data Ult. Reg. Receb.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Hora Ult. Reg. Receb."  agrupador='false' role='cabecalho' tam='10'  onrowdraw='["var hrAtual = RetornaColuna(registro, RetornaSeqColuna(grid, \"HRATUAL\"), true).split(\":\");\nvar timeAtual = new Date();\ntimeAtual.setHours(...hrAtual);\ntimeAtual.addMinutes(-30);\n\nif (parseInt(valor.replace(/:|\\./g, \"\"), 10) > 0 && comparaTime(timeAtual.toLocaleTimeString(), \">\", valor)) {\n    cor = \"TOMATO\";\n}\ncolunas = [RetornaSeqColuna(grid, \"HRULTIMOREC\"), RetornaSeqColuna(grid, \"DTULTIMOREC\")];"]' style='position:relative;' rel='H' cp='HRULTIMOREC'><div style=''><div style='float:left;'>Hora Ult. Reg. Receb.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Ultimo Reg. Env."  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;' rel='I' cp='ULTIMOENV'><div style='text-align: right;'><div style='float:left;'>Ultimo Reg. Env.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Qtde Falta Receber"  agrupador='false' role='cabecalho' tam='10'  onrowdraw='["valor = valor.replaceAll(\".\", \"\").replace(\",\", \".\");\nvalor = parseInt(valor, 10);\nif (valor > 0 && valor < 999) {\n    cor = \"#80ff80\";\n} else if (valor > 5000 && valor < 9999) {\n    cor = \"#ffff00\";\n} else if (valor > 9999) {\n    cor = \"TOMATO\";\n}\ncolunas = [RetornaSeqColuna(grid, \"FALTARECEBER\")];"]' style='position:relative;' rel='I' cp='FALTARECEBER'><div style='text-align: right;'><div style='float:left;'>Qtde Falta Receber</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Data Ult. Reg. Env."  agrupador='false' role='cabecalho' tam='10'  onrowdraw='["var dtAtual = RetornaColuna(registro, RetornaSeqColuna(grid, \"DTATUAL\"), true);\n\nif (comparaData(dtAtual, \">\", valor)) {\n    cor = \"TOMATO\";\n}\ncolunas = [RetornaSeqColuna(grid, \"HRULTIMOENV\"), RetornaSeqColuna(grid, \"DTULTIMOENV\")];"]' style='position:relative;' rel='D' cp='DTULTIMOENV'><div style=''><div style='float:left;'>Data Ult. Reg. Env.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Hora Ultimo Reg. Env."  agrupador='false' role='cabecalho' tam='10'  onrowdraw='["var hrAtual = RetornaColuna(registro, RetornaSeqColuna(grid, \"HRATUAL\"), true).split(\":\");\nvar timeAtual = new Date();\ntimeAtual.setHours(...hrAtual);\ntimeAtual.addMinutes(-30);\n\nif (parseInt(valor.replace(/:|\\./g, \"\"), 10) > 0 && comparaTime(timeAtual.toLocaleTimeString(), \">\", valor)) {\n    cor = \"TOMATO\";\n}\ncolunas = [RetornaSeqColuna(grid, \"HRULTIMOENV\"), RetornaSeqColuna(grid, \"DTULTIMOENV\")];"]' style='position:relative;' rel='H' cp='HRULTIMOENV'><div style=''><div style='float:left;'>Hora Ultimo Reg. Env.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Qtde Falta Enviar"  agrupador='false' role='cabecalho' tam='10'  onrowdraw='["valor = valor.replaceAll(\".\", \"\").replace(\",\", \".\");\nvalor = parseInt(valor, 10);\nif (valor > 0 && valor < 999) {\n    cor = \"#80ff80\";\n} else if (valor > 5000 && valor < 9999) {\n    cor = \"#ffff00\";\n} else if (valor > 9999) {\n    cor = \"TOMATO\";\n}\ncolunas = [RetornaSeqColuna(grid, \"FALTAENV\")];"]' style='position:relative;' rel='I' cp='FALTAENV'><div style='text-align: right;'><div style='float:left;'>Qtde Falta Enviar</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Qtde Receber"  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;' rel='I' cp='QTDEREC'><div style='text-align: right;'><div style='float:left;'>Qtde Receber</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Qtde Enviar"  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;' rel='I' cp='QTDEENV'><div style='text-align: right;'><div style='float:left;'>Qtde Enviar</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Log Filial p/ Sinc."  agrupador='false' role='cabecalho' tam='30'  onrowdraw='["if (trim(valor) !== \"\") {\n    cor = \"#ffff00\";\n}\ncolunas = [RetornaSeqColuna(grid, \"PROBLEMA\")];"]' style='position:relative;' rel='M' cp='PROBLEMA'><div style=''><div style='float:left;'>Log Filial p/ Sinc.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Data Atual"  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;display:none;' rel='D' cp='DTATUAL'><div style=''><div style='float:left;'>Data Atual</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Log Sinc. p/ Filial"  agrupador='false' role='cabecalho' tam='30'  onrowdraw='["if (trim(valor) !== \"\") {\n    cor = \"#ffff00\";\n}\ncolunas = [RetornaSeqColuna(grid, \"PROBLEMAREC\")];"]' style='position:relative;' rel='M' cp='PROBLEMAREC'><div style=''><div style='float:left;'>Log Sinc. p/ Filial</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Hr Atual"  agrupador='false' role='cabecalho' tam='8'  onrowdraw='[]' style='position:relative;display:none;' rel='H' cp='HRATUAL'><div style=''><div style='float:left;'>Hr Atual</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th></tr></thead></table></div><div class="div-grid-table-vistas" style='position: absolute;top: 53px;left: 0px;right: 0px;bottom: 0px;'><table id="tblBody" class="TGrid" cellpadding="0" cellspacing="0"><tbody><tr><td coluna='Cód. Local' id='CLOCAL' qtdecaracter='26.0' style=''><div  style='' onclick='' >4</div></td><td coluna='Filial' id='NOMEFILIAL' qtdecaracter='128.0' style=''><div  style='' onclick='' >BANCO TECNICON</div></td><td coluna='Ultimo Reg. Receb.' id='ULTIMOREC'  style=''><div  style='text-align: right;' onclick='' ></div></td><td coluna='Data Ult. Reg. Receb.' id='DTULTIMOREC'  style=''><div  style='' onclick='' >14/11/2025</div></td><td coluna='Hora Ult. Reg. Receb.' id='HRULTIMOREC' qtdecaracter='74.0' style=''><div  style='' onclick='' >15:21:48</div></td><td coluna='Ultimo Reg. Env.' id='ULTIMOENV'  style=''><div  style='text-align: right;' onclick='' >10.290.761</div></td><td coluna='Qtde Falta Receber' id='FALTARECEBER'  style=''><div  style='text-align: right;' onclick='' ></div></td><td coluna='Data Ult. Reg. Env.' id='DTULTIMOENV'  style=''><div  style='' onclick='' >14/11/2025</div></td><td coluna='Hora Ultimo Reg. Env.' id='HRULTIMOENV' qtdecaracter='74.0' style=''><div  style='' onclick='' >15:21:48</div></td><td coluna='Qtde Falta Enviar' id='FALTAENV'  style=''><div  style='text-align: right;' onclick='' >1</div></td><td coluna='Qtde Receber' id='QTDEREC'  style=''><div  style='text-align: right;' onclick='' >500</div></td><td coluna='Qtde Enviar' id='QTDEENV'  style=''><div  style='text-align: right;' onclick='' >500</div></td><td coluna='Log Filial p/ Sinc.' id='PROBLEMA' qtdecaracter='18.0' style=''><div  style='' onclick='' ></div></td><td coluna='Data Atual' id='DTATUAL'  style='display:none;'><div  style='' onclick='' >14/11/2025</div></td><td coluna='Log Sinc. p/ Filial' id='PROBLEMAREC' qtdecaracter='18.0' style=''><div  style='' onclick='' ></div></td><td coluna='Hr Atual' id='HRATUAL' qtdecaracter='74.0' style='display:none;'><div  style='' onclick='' >15:22:04</div></td></tr></tbody></table></div><div style='display: none;' id='dvFiltroEsp'><div class='div-campos' style='height: 52px; left: 0; top: 0; position: relative;'><div style='float: left; margin-right: 1em;'><label class='label-input'>Campo:</label><br><select  vdefault='' class='combobox-padrao'  style="max-width:180px;" id='sCampo' name='sCampo'><option selected='selected' value='CLOCAL'>Cód. Local</option><option  value='NOMEFILIAL'>Filial</option><option  value='ULTIMOREC'>Ultimo Reg. Receb.</option><option  value='DTULTIMOREC'>Data Ult. Reg. Receb.</option><option  value='HRULTIMOREC'>Hora Ult. Reg. Receb.</option><option  value='ULTIMOENV'>Ultimo Reg. Env.</option><option  value='FALTARECEBER'>Qtde Falta Receber</option><option  value='DTULTIMOENV'>Data Ult. Reg. Env.</option><option  value='HRULTIMOENV'>Hora Ultimo Reg. Env.</option><option  value='FALTAENV'>Qtde Falta Enviar</option><option  value='QTDEREC'>Qtde Receber</option><option  value='QTDEENV'>Qtde Enviar</option><option  value='PROBLEMA'>Log Filial p/ Sinc.</option><option  value='DTATUAL'>Data Atual</option><option  value='PROBLEMAREC'>Log Sinc. p/ Filial</option><option  value='HRATUAL'>Hr Atual</option></select></div><div style='float: left; margin-right: 1em;'><label class='label-input'>Comparador:</label><br><select  vdefault='' class='combobox-padrao'  id='tpComparador' name='tpComparador'><option selected='selected' value='='>=</option><option  value='Iniciar'>Iniciar</option><option  value='Contém'>Contém</option><option  value='nao_contem'>Não Contém</option><option  value='<>'><></option><option  value='>'>></option><option  value='<'><</option><option  value='>='>>=</option><option  value='<='><=</option></select></div><div style='float: left; margin-right: 1em;'><label style='max-width:500px;' class="label-input">Busca:</label><br><input    valida="" class="input-padrao" name="txbBusca"maxlength="15" style="float: left; width:120px;max-width:500px;" type="text" id="txbBusca" tipocomponente="tvarchar"></div><div style='float: left; margin: 1.1em 1em 0 0;'> <input   class="btn-padrao" tipoComponente ="tbutton" id="btnAdd" class="btn-padrao" value="+"  type="button" onclick="addFiltroEsp(this);"/></div><div style='float: left; margin: 1.1em 1em 0 0;'> <input   class="btn-padrao" tipoComponente ="tbutton" id="btnFiltraEsp" class="btn-padrao" value="Filtrar"  type="button" onclick="filtrarEspecial(this);"/></div></div><table id='filtroTmp' class='filtros'><thead><tr><th style='text-align: left'>Campo</th><th style='text-align: left'>Operador</th><th style='text-align: left'>Valor</th><th></th></tr></thead><tbody></tbody></table></div></div></fieldset><br></fieldset><script>   setTimeout(function(){       if(quemsou) {            var fieldset = quemsou.querySelector('#fs29021');           if (fieldset!=undefined && fieldset!=null) {               var vista = parentUntilAttr(fieldset,'role','vista');               vista.style.zIndex = (zindexJanela-2);           }       }   },100);</script></div>'''
        
        # Testa com HTML real
        result = parse_status_page(html_real)
        
        # Deve retornar OK pois não há logs com problemas e o tempo está dentro do limite
        print(f"Resultado: {result}")
        self.assertEqual(result['problema_envio'], '')
    
    def test_html_real_com_problema_log(self):
        """Testa com HTML real modificado para ter problema no log."""
        # Modifica o HTML para ter um problema no log
        html_com_problema = '''<div class='vista-role' style='position: absolute; top:0px; left:0px; bottom:4px; right:0px; overflow: auto;' role='vista' perfil='' cvista='2052' svistaaba='2902'>   <div id='tbltblConCon2902' role='grid' class='div-grid-vistas' tempoupdate='00:00:00' cabecalho='Cód. Local||Filial||Ultimo Reg. Receb.||Data Ult. Reg. Receb.||Hora Ult. Reg. Receb.||Ultimo Reg. Env.||Qtde Falta Receber||Data Ult. Reg. Env.||Hora Ultimo Reg. Env.||Qtde Falta Enviar||Qtde Receber||Qtde Enviar||Log Filial p/ Sinc.||Data Atual||Log Sinc. p/ Filial||Hr Atual' style='position: absolute;top: 59px;left: 0px;right: 0px;bottom: 10px;' realce='null'>     <div class="div-header-grid">         <table id="tblHead" class="TGrid" cellpadding="0" cellspacing="0"><thead><tr><th title="Cód. Local"  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;' rel='V' cp='CLOCAL'><div style=''><div style='float:left;'>Cód. Local</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Filial"  agrupador='false' role='cabecalho' tam='50'  onrowdraw='[]' style='position:relative;' rel='V' cp='NOMEFILIAL'><div style=''><div style='float:left;'>Filial</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Data Ult. Reg. Env."  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;' rel='D' cp='DTULTIMOENV'><div style=''><div style='float:left;'>Data Ult. Reg. Env.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Hora Ultimo Reg. Env."  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;' rel='H' cp='HRULTIMOENV'><div style=''><div style='float:left;'>Hora Ultimo Reg. Env.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Log Filial p/ Sinc."  agrupador='false' role='cabecalho' tam='30'  onrowdraw='["if (trim(valor) !== \"\") {\n    cor = \"#ffff00\";\n}\ncolunas = [RetornaSeqColuna(grid, \"PROBLEMA\")];"]' style='position:relative;' rel='M' cp='PROBLEMA'><div style=''><div style='float:left;'>Log Filial p/ Sinc.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th></tr></thead></table></div><div class="div-grid-table-vistas" style='position: absolute;top: 53px;left: 0px;right: 0px;bottom: 0px;'><table id="tblBody" class="TGrid" cellpadding="0" cellspacing="0"><tbody><tr><td coluna='Cód. Local' id='CLOCAL' qtdecaracter='26.0' style=''><div  style='' onclick='' >4</div></td><td coluna='Filial' id='NOMEFILIAL' qtdecaracter='128.0' style=''><div  style='' onclick='' >BANCO TECNICON</div></td><td coluna='Data Ult. Reg. Env.' id='DTULTIMOENV'  style=''><div  style='' onclick='' >14/11/2025</div></td><td coluna='Hora Ultimo Reg. Env.' id='HRULTIMOENV' qtdecaracter='74.0' style=''><div  style='' onclick='' >15:21:48</div></td><td coluna='Log Filial p/ Sinc.' id='PROBLEMA' qtdecaracter='18.0' style=''><div  style='' onclick='' >Erro de conexão com servidor</div></td></tr></tbody></table></div></div></div>'''
        
        result = parse_status_page(html_com_problema)
        
        # Deve reportar o problema no log
        print(f"Resultado com problema: {result}")
        self.assertIn('Erro de conexão com servidor', result['problema_envio'])
    
    def test_html_real_tempo_excedido(self):
        """Testa com HTML real modificado para ter tempo excedido."""
        # Modifica o HTML para ter tempo excedido (6 minutos atrás)
        html_tempo_excedido = '''<div class='vista-role' style='position: absolute; top:0px; left:0px; bottom:4px; right:0px; overflow: auto;' role='vista' perfil='' cvista='2052' svistaaba='2902'>   <div id='tbltblConCon2902' role='grid' class='div-grid-vistas' tempoupdate='00:00:00' cabecalho='Cód. Local||Filial||Ultimo Reg. Receb.||Data Ult. Reg. Receb.||Hora Ult. Reg. Receb.||Ultimo Reg. Env.||Qtde Falta Receber||Data Ult. Reg. Env.||Hora Ultimo Reg. Env.||Qtde Falta Enviar||Qtde Receber||Qtde Enviar||Log Filial p/ Sinc.||Data Atual||Log Sinc. p/ Filial||Hr Atual' style='position: absolute;top: 59px;left: 0px;right: 0px;bottom: 10px;' realce='null'>     <div class="div-header-grid">         <table id="tblHead" class="TGrid" cellpadding="0" cellspacing="0"><thead><tr><th title="Cód. Local"  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;' rel='V' cp='CLOCAL'><div style=''><div style='float:left;'>Cód. Local</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Filial"  agrupador='false' role='cabecalho' tam='50'  onrowdraw='[]' style='position:relative;' rel='V' cp='NOMEFILIAL'><div style=''><div style='float:left;'>Filial</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Data Ult. Reg. Env."  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;' rel='D' cp='DTULTIMOENV'><div style=''><div style='float:left;'>Data Ult. Reg. Env.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Hora Ultimo Reg. Env."  agrupador='false' role='cabecalho' tam='10'  onrowdraw='[]' style='position:relative;' rel='H' cp='HRULTIMOENV'><div style=''><div style='float:left;'>Hora Ultimo Reg. Env.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th><th title="Log Filial p/ Sinc."  agrupador='false' role='cabecalho' tam='30'  onrowdraw='["if (trim(valor) !== \"\") {\n    cor = \"#ffff00\";\n}\ncolunas = [RetornaSeqColuna(grid, \"PROBLEMA\")];"]' style='position:relative;' rel='M' cp='PROBLEMA'><div style=''><div style='float:left;'>Log Filial p/ Sinc.</div></div>   <div style='position:absolute;right:0px' class="pButton-col"><span></span></div></th></tr></thead></table></div><div class="div-grid-table-vistas" style='position: absolute;top: 53px;left: 0px;right: 0px;bottom: 0px;'><table id="tblBody" class="TGrid" cellpadding="0" cellspacing="0"><tbody><tr><td coluna='Cód. Local' id='CLOCAL' qtdecaracter='26.0' style=''><div  style='' onclick='' >4</div></td><td coluna='Filial' id='NOMEFILIAL' qtdecaracter='128.0' style=''><div  style='' onclick='' >BANCO TECNICON</div></td><td coluna='Data Ult. Reg. Env.' id='DTULTIMOENV'  style=''><div  style='' onclick='' >14/11/2025</div></td><td coluna='Hora Ultimo Reg. Env.' id='HRULTIMOENV' qtdecaracter='74.0' style=''><div  style='' onclick='' >09:21:48</div></td><td coluna='Log Filial p/ Sinc.' id='PROBLEMA' qtdecaracter='18.0' style=''><div  style='' onclick='' ></div></td></tr></tbody></table></div></div></div>'''
        
        result = parse_status_page(html_tempo_excedido)
        
        # Deve reportar o problema de tempo excedido
        print(f"Resultado tempo excedido: {result}")
        self.assertIn('Tempo limite excedido', result['problema_envio'])

if __name__ == '__main__':
    # Executa os testes
    unittest.main(verbosity=2)